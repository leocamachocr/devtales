---
import { getCollection } from 'astro:content';
import PostsLayout from '../../layouts/PostsLayout.astro';
import { formatDate, formatRelativeDate } from '../../utils/content';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<PostsLayout title={post.data.title}>
  <post class="card">
    {post.data.image && (
      <div class="hero-image">
        <img 
          src={post.data.image} 
          alt={post.data.imageAlt || post.data.title}
          loading="lazy"
        />
      </div>
    )}
    <h1>{post.data.title}</h1>
    <p class="article-meta">
      <time title={formatDate(post.data.date)}>{formatRelativeDate(post.data.date)}</time>
      <span> â€¢ </span>
      <span>by {post.data.author}</span>
    </p>
    <p><em>{post.data.description}</em></p>
    
    {post.data.tags && post.data.tags.length > 0 && (
      <div class="tags">
        {post.data.tags.map((tag) => (
          <a href={`/devtales/tags#${tag}`} class="tag">#{tag}</a>
        ))}
      </div>
    )}
    
    <br/>
    <Content />
  </post>
</PostsLayout>
